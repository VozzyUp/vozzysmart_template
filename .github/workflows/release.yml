name: Release

on:
  push:
    branches:
      - main

permissions:
  contents: write

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # pega Ãºltima tag
      - name: Get previous tag
        id: previoustag
        run: |
          echo "tag=$(git describe --tags --abbrev=0 2>/dev/null || echo '')" >> $GITHUB_OUTPUT

      # gera lista de arquivos alterados
      - name: Generate update manifest
        run: |
          if [ -z "${{ steps.previoustag.outputs.tag }}" ]; then
            git ls-files > files.txt
          else
            git diff --name-only ${{ steps.previoustag.outputs.tag }} HEAD > files.txt
          fi

          echo '{ "version": "auto", "files": [' > update-manifest.json
          awk '{printf "\
